median(bluebook.values, na.rm = TRUE)
oldclaim.values[is.na(oldclaim.values)] <-
median(oldclaim.values, na.rm = TRUE)
# Recombine into data frame
dollar.values <-
data.frame(cbind(income.values,
home.values,
bluebook.values,
oldclaim.values))
dollar.values.stats <-
data.frame(cbind(income.values.stat,
home.values.stat,
bluebook.values.stat,
oldclaim.values.stat))
# Join with training data
tdata <- data.frame(cbind(tdata, dollar.values))
# Select character variables
chars <- dplyr::select(tdata, where(is.character))
# Use function to extract dollars
to_num <- function(x){
x <- as.character(x)
x <- gsub(",", "", x)
x <- gsub("\\$", "", x)
as.numeric(x)
}
# Specify those dollar variables
income.values <- to_num(chars$INCOME)
home.values <- to_num(chars$HOME_VAL)
bluebook.values <- to_num(chars$BLUEBOOK)
oldclaim.values <- to_num(chars$OLDCLAIM)
concept_df <- as.data.frame(cbind(income.values,
home.values,
bluebook.values,
oldclaim.values))
income.values.stat <- to_num(chars$INCOME)
home.values.stat <- to_num(chars$HOME_VAL)
bluebook.values.stat <- to_num(chars$BLUEBOOK)
oldclaim.values.stat <- to_num(chars$OLDCLAIM)
# impute median values for missing variables
income.values[is.na(income.values)] <-
median(income.values, na.rm = TRUE)
home.values[is.na(home.values)] <-
median(home.values, na.rm = TRUE)
bluebook.values[is.na(bluebook.values)] <-
median(bluebook.values, na.rm = TRUE)
oldclaim.values[is.na(oldclaim.values)] <-
median(oldclaim.values, na.rm = TRUE)
# Recombine into data frame
dollar.values <-
data.frame(cbind(income.values,
home.values,
bluebook.values,
oldclaim.values))
dollar.values.stats <-
data.frame(cbind(income.values.stat,
home.values.stat,
bluebook.values.stat,
oldclaim.values.stat))
# Join with training data
tdata <- data.frame(cbind(tdata, dollar.values))
# Select character variables
chars <- dplyr::select(tdata, where(is.character))
# Use function to extract dollars
to_num <- function(x){
x <- as.character(x)
x <- gsub(",", "", x)
x <- gsub("\\$", "", x)
as.numeric(x)
}
# Specify those dollar variables
income.values <- to_num(chars$INCOME)
home.values <- to_num(chars$HOME_VAL)
bluebook.values <- to_num(chars$BLUEBOOK)
oldclaim.values <- to_num(chars$OLDCLAIM)
concept_df <- as.data.frame(cbind(income.values,
home.values,
bluebook.values,
oldclaim.values))
income.values.stat <- to_num(chars$INCOME)
home.values.stat <- to_num(chars$HOME_VAL)
bluebook.values.stat <- to_num(chars$BLUEBOOK)
oldclaim.values.stat <- to_num(chars$OLDCLAIM)
# impute median values for missing variables
income.values[is.na(income.values)] <-
median(income.values, na.rm = TRUE)
home.values[is.na(home.values)] <-
median(home.values, na.rm = TRUE)
bluebook.values[is.na(bluebook.values)] <-
median(bluebook.values, na.rm = TRUE)
oldclaim.values[is.na(oldclaim.values)] <-
median(oldclaim.values, na.rm = TRUE)
# Recombine into data frame
dollar.values <-
data.frame(cbind(income.values,
home.values,
bluebook.values,
oldclaim.values))
dollar.values.stats <-
data.frame(cbind(income.values.stat,
home.values.stat,
bluebook.values.stat,
oldclaim.values.stat))
# Join with training data
tdata <- data.frame(cbind(tdata, dollar.values))
# Select character variables
chars <- dplyr::select(tdata, where(is.character))
# Select character variables
chars <- dplyr::select(tdata, where(is.character))
# Select character variables
chars <- tdata %>%
dplyr::select_if(is.character)
# Select character variables
chars <- tdata %>%
dplyr::select_if(is.character)
# Use function to extract dollars
to_num <- function(x){
x <- as.character(x)
x <- gsub(",", "", x)
x <- gsub("\\$", "", x)
as.numeric(x)
}
# Specify those dollar variables
income.values <- to_num(chars$INCOME)
home.values <- to_num(chars$HOME_VAL)
bluebook.values <- to_num(chars$BLUEBOOK)
oldclaim.values <- to_num(chars$OLDCLAIM)
concept_df <- as.data.frame(cbind(income.values,
home.values,
bluebook.values,
oldclaim.values))
income.values.stat <- to_num(chars$INCOME)
home.values.stat <- to_num(chars$HOME_VAL)
bluebook.values.stat <- to_num(chars$BLUEBOOK)
oldclaim.values.stat <- to_num(chars$OLDCLAIM)
# impute median values for missing variables
income.values[is.na(income.values)] <-
median(income.values, na.rm = TRUE)
home.values[is.na(home.values)] <-
median(home.values, na.rm = TRUE)
bluebook.values[is.na(bluebook.values)] <-
median(bluebook.values, na.rm = TRUE)
oldclaim.values[is.na(oldclaim.values)] <-
median(oldclaim.values, na.rm = TRUE)
# Recombine into data frame
dollar.values <-
data.frame(cbind(income.values,
home.values,
bluebook.values,
oldclaim.values))
dollar.values.stats <-
data.frame(cbind(income.values.stat,
home.values.stat,
bluebook.values.stat,
oldclaim.values.stat))
# Join with training data
tdata <- data.frame(cbind(tdata, dollar.values))
# Select character variables
chars <- tdata %>%
dplyr::select_if(is.character)
# Use function to extract dollars
to_num <- function(x){
x <- as.character(x)
x <- gsub(",", "", x)
x <- gsub("\\$", "", x)
as.numeric(x)
}
# Specify those dollar variables
income.values <- to_num(chars$INCOME)
home.values <- to_num(chars$HOME_VAL)
bluebook.values <- to_num(chars$BLUEBOOK)
oldclaim.values <- to_num(chars$OLDCLAIM)
concept_df <- as.data.frame(cbind(income.values,
home.values,
bluebook.values,
oldclaim.values))
# Select character variables
chars <- tdata %>%
dplyr::select_if(is.character)
tdata %>%
dplyr::select_if(is.character)
knitr::opts_chunk$set(echo = TRUE)
# Packages
library(tidyverse)
library(kableExtra)
library(ggcorrplot)
library(reshape2)
library(bestNormalize)
library(caret)
library(MASS)
library(pROC)
library(stats)
library(ROCR)
theme_set(theme_minimal())
# short descriptions of variables as table from matrix
vardesc <- data.frame(matrix(c(
'INDEX',	'Identification variable',
'TARGET_FLAG',	'Was car in a crash? 1 = Yes, 0 = No',
'TARGET_AMT',	'Cost of car crash',
'AGE',	'Age of driver',
'BLUEBOOK',	'Value of vehicle',
'CAR_AGE',	'Vehicle age',
'CAR_TYPE',	'Type of car',
'CAR_USE', 'Main purpose the vehicle is used for',
'CLM_FREQ',	'Number of claims filed in past five years',
'EDUCATION',	'Maximum education level',
'HOMEKIDS',	'Number of children at home',
'HOME_VAL',	'Value of driver\'s home',
'INCOME',	'Annual income of the driver',
'JOB',	'Type of job by standard collar categories',
'KIDSDRIV',	'Number of children who drive',
'MSTATUS',	'Marital status',
'MVR_PTS',	'Motor vehicle inspection points',
'OLDCLAIM',	'Total claims payout in past five years',
'PARENT1',	'Single parent status',
'RED_CAR',	'1 if car is red, 0 if not',
'REVOKED',	'License revoked in past 7 years status',
'SEX',	'Driver gender',
'TIF',	'Time in force',
'TRAVETIME',	'Distance to work in minutes',
'URBANICITY',	'Category of how urban the area the driver lives is',
'YOJ', 'Number of years on the job'
),  byrow = TRUE, ncol = 2))
colnames(vardesc) <- c('Variable', 'Description')
kbl(vardesc, booktabs = T, caption = "Variable Descriptions") %>%
kable_styling(latex_options = c("striped", "HOLD_position"), full_width = F)
tdata <- read.csv(
"https://raw.githubusercontent.com/palmorezm/msds/main/621/HW4/insurance_training_data.csv")
edata <- read.csv(
"https://raw.githubusercontent.com/palmorezm/msds/main/621/HW4/insurance-evaluation-data.csv")
initialobs <- tdata[1:4,]
kbl(t(initialobs), booktabs = T, caption = "Initial Observations") %>%
kable_styling(latex_options = c("striped", "HOLD_position"), full_width = F) %>%
add_header_above(c(" ", " ", "Row Number", " ", " ")) %>%
footnote(c("Includes the first four observations of all variables in the data"))
# theoretical effects
vareffects <- data.frame(matrix(c(
'INDEX',	'None',
'TARGET_FLAG',	'None',
'TARGET_AMT',	'None',
'AGE',	'Youngest and Oldest may have higher risk of accident',
'BLUEBOOK',	'Unknown on probability of collision but correlated with payout',
'CAR_AGE',	'Unknown on probability of collision but correlated with payout',
'CAR_TYPE',	'Unknown on probability of collision but correlated with payout',
'CAR_USE', 'Commerical vehicles might increase risk of accident',
'CLM_FREQ',	'Higher claim frequency increases likelihood of future claims',
'EDUCATION',	'Theoretically higher education levels lower risk',
'HOMEKIDS',	'Unknown',
'HOME_VAL',	'Theoretically home owners reduce risk due to more responsible driving',
'INCOME',	'Theoretically wealthier drivers have fewer accidents',
'JOB',	'Theoretically white collar+ jobs are safer',
'KIDSDRIV',	'Increased risk of accident from inexperienced driver',
'MSTATUS',	'Theoretically married people drive safer',
'MVR_PTS',	'Increased risk of accident',
'OLDCLAIM',	'Increased risk of higher payout with previous payout',
'PARENT1',	'Unknown',
'RED_CAR',	'Theoretically increased risk of accident based on urban legend',
'REVOKED',	'Increased risk of accident if revoked',
'SEX',	'Theoretically increased risk of accident for women based on urban legend',
'TIF',	'Decreased risk for those who have greater loyalty',
'TRAVETIME',	'Longer distances increase risk of accident',
'URBANICITY',	'The more urban the area the greater the risk of accident',
'YOJ', 'Decreased risk for those with greater longevity'
),  byrow = TRUE, ncol = 2))
colnames(vareffects) <- c('Variable', 'Effect')
kbl(vareffects, booktabs = T, caption = "Theoretical Variable Effects") %>%
kable_styling(latex_options = c("striped", "HOLD_position"), full_width = F)
tdata.nas <- lapply(tdata, function(x) sum(is.na(x)))
tdata.len <- lapply(tdata, function(x) length(x))
tdata.permis <- lapply(tdata, function(x) round(sum(is.na(x))/length(x)*100, 1))
tdata.types <- lapply(tdata, function(x) class(x))
tdata.firstob <- lapply(tdata, function(x) head(x, 1))
tdata.uniques <- lapply(tdata, function(x) length(unique(factor(x))))
tdata.tbl.natypes <- cbind(tdata.nas, tdata.len, tdata.permis, tdata.types, tdata.firstob, tdata.uniques)
colnames(tdata.tbl.natypes) <- c("Missing", "Total", "%", "Data Type", "Example", "Factors")
kbl(tdata.tbl.natypes, booktabs = T, caption = "Data Characteristics") %>%
kable_styling(latex_options = c("striped", "HOLD_position"), full_width = F)
tdata.summary.tbl <- summary(tdata)
kbl(t(tdata.summary.tbl), booktabs = T, caption = "Summary Characteristics") %>%
kable_styling(latex_options = c("striped", "scale_down", "hold_position"), full_width = F)
tdata %>%
select_if(is.numeric) %>%
gather %>%
ggplot() +
facet_wrap(~ key, scales = "free") +
geom_density(aes(value, color = value, fill = key, alpha = .5)) + theme(axis.title = element_blank(), legend.position = "none") + ggtitle("Numeric Variable Density") + theme(plot.title = element_text(hjust = 0.5))
tdata %>%
select_if(is.numeric) %>%
gather %>%
ggplot(aes(value, key)) +
facet_wrap(~ key, scales = "free") +
geom_violin(aes(color = key, alpha = 1)) +
geom_boxplot(aes(fill = key, alpha = .5), notch = TRUE, size = .1, lty = 3) +
stat_summary(fun.y = mean, geom = "point",
shape = 8, size = 1.5, color = "#000000") +
theme(axis.text = element_blank(),
axis.title = element_blank(),
legend.position = "none") +
ggtitle("Numeric Variable KDE & Distribution") +
theme(plot.title = element_text(hjust = 0.5))
tdata %>%
select_if(is.integer) %>%
gather() %>%
filter(value == 0 | 1) %>%
group_by(key) %>%
ggplot() +
facet_wrap(~ key, scales = "free") +
geom_bar(aes(value, color = value, fill = key, alpha = .5)) + theme(axis.title = element_blank(), legend.position = "none") + ggtitle("Integer Frequencies") + theme(plot.title = element_text(hjust = 0.5))
tdata %>%
dplyr::select(TARGET_FLAG, MVR_PTS, CLM_FREQ, HOMEKIDS, KIDSDRIV, TIF) %>%
gather() %>%
ggplot(aes(value)) +
facet_wrap(~ key, scales = "free") +
geom_bar(aes(value, color = key, fill = key, alpha = .5)) + theme(axis.title = element_blank(), legend.position = "none") + ggtitle("Select Integer Frequencies") + theme(plot.title = element_text(hjust = 0.5))
tdata %>%
select_if(is.numeric) %>%
cor() %>%
ggcorrplot(method = "circle", type="upper",
ggtheme = ggplot2::theme_minimal, legend.title = "Influence") + coord_flip()
# Select character variables
chars <- tdata %>%
dplyr::select_if(is.character)
1/8161
knitr::opts_chunk$set(echo = TRUE)
# Packages
library(tidyverse)
library(kableExtra)
library(ggcorrplot)
library(reshape2)
library(bestNormalize)
library(caret)
library(MASS)
library(pROC)
library(stats)
library(ROCR)
theme_set(theme_minimal())
# short descriptions of variables as table from matrix
vardesc <- data.frame(matrix(c(
'INDEX',	'Identification variable',
'TARGET_FLAG',	'Was car in a crash? 1 = Yes, 0 = No',
'TARGET_AMT',	'Cost of car crash',
'AGE',	'Age of driver',
'BLUEBOOK',	'Value of vehicle',
'CAR_AGE',	'Vehicle age',
'CAR_TYPE',	'Type of car',
'CAR_USE', 'Main purpose the vehicle is used for',
'CLM_FREQ',	'Number of claims filed in past five years',
'EDUCATION',	'Maximum education level',
'HOMEKIDS',	'Number of children at home',
'HOME_VAL',	'Value of driver\'s home',
'INCOME',	'Annual income of the driver',
'JOB',	'Type of job by standard collar categories',
'KIDSDRIV',	'Number of children who drive',
'MSTATUS',	'Marital status',
'MVR_PTS',	'Motor vehicle inspection points',
'OLDCLAIM',	'Total claims payout in past five years',
'PARENT1',	'Single parent status',
'RED_CAR',	'1 if car is red, 0 if not',
'REVOKED',	'License revoked in past 7 years status',
'SEX',	'Driver gender',
'TIF',	'Time in force',
'TRAVETIME',	'Distance to work in minutes',
'URBANICITY',	'Category of how urban the area the driver lives is',
'YOJ', 'Number of years on the job'
),  byrow = TRUE, ncol = 2))
colnames(vardesc) <- c('Variable', 'Description')
kbl(vardesc, booktabs = T, caption = "Variable Descriptions") %>%
kable_styling(latex_options = c("striped", "HOLD_position"), full_width = F)
tdata <- read.csv(
"https://raw.githubusercontent.com/palmorezm/msds/main/621/HW4/insurance_training_data.csv")
edata <- read.csv(
"https://raw.githubusercontent.com/palmorezm/msds/main/621/HW4/insurance-evaluation-data.csv")
initialobs <- tdata[1:4,]
kbl(t(initialobs), booktabs = T, caption = "Initial Observations") %>%
kable_styling(latex_options = c("striped", "HOLD_position"), full_width = F) %>%
add_header_above(c(" ", " ", "Row Number", " ", " ")) %>%
footnote(c("Includes the first four observations of all variables in the data"))
# theoretical effects
vareffects <- data.frame(matrix(c(
'INDEX',	'None',
'TARGET_FLAG',	'None',
'TARGET_AMT',	'None',
'AGE',	'Youngest and Oldest may have higher risk of accident',
'BLUEBOOK',	'Unknown on probability of collision but correlated with payout',
'CAR_AGE',	'Unknown on probability of collision but correlated with payout',
'CAR_TYPE',	'Unknown on probability of collision but correlated with payout',
'CAR_USE', 'Commerical vehicles might increase risk of accident',
'CLM_FREQ',	'Higher claim frequency increases likelihood of future claims',
'EDUCATION',	'Theoretically higher education levels lower risk',
'HOMEKIDS',	'Unknown',
'HOME_VAL',	'Theoretically home owners reduce risk due to more responsible driving',
'INCOME',	'Theoretically wealthier drivers have fewer accidents',
'JOB',	'Theoretically white collar+ jobs are safer',
'KIDSDRIV',	'Increased risk of accident from inexperienced driver',
'MSTATUS',	'Theoretically married people drive safer',
'MVR_PTS',	'Increased risk of accident',
'OLDCLAIM',	'Increased risk of higher payout with previous payout',
'PARENT1',	'Unknown',
'RED_CAR',	'Theoretically increased risk of accident based on urban legend',
'REVOKED',	'Increased risk of accident if revoked',
'SEX',	'Theoretically increased risk of accident for women based on urban legend',
'TIF',	'Decreased risk for those who have greater loyalty',
'TRAVETIME',	'Longer distances increase risk of accident',
'URBANICITY',	'The more urban the area the greater the risk of accident',
'YOJ', 'Decreased risk for those with greater longevity'
),  byrow = TRUE, ncol = 2))
colnames(vareffects) <- c('Variable', 'Effect')
kbl(vareffects, booktabs = T, caption = "Theoretical Variable Effects") %>%
kable_styling(latex_options = c("striped", "HOLD_position"), full_width = F)
tdata.nas <- lapply(tdata, function(x) sum(is.na(x)))
tdata.len <- lapply(tdata, function(x) length(x))
tdata.permis <- lapply(tdata, function(x) round(sum(is.na(x))/length(x)*100, 1))
tdata.types <- lapply(tdata, function(x) class(x))
tdata.firstob <- lapply(tdata, function(x) head(x, 1))
tdata.uniques <- lapply(tdata, function(x) length(unique(factor(x))))
tdata.tbl.natypes <- cbind(tdata.nas, tdata.len, tdata.permis, tdata.types, tdata.firstob, tdata.uniques)
colnames(tdata.tbl.natypes) <- c("Missing", "Total", "%", "Data Type", "Example", "Factors")
kbl(tdata.tbl.natypes, booktabs = T, caption = "Data Characteristics") %>%
kable_styling(latex_options = c("striped", "HOLD_position"), full_width = F)
tdata.summary.tbl <- summary(tdata)
kbl(t(tdata.summary.tbl), booktabs = T, caption = "Summary Characteristics") %>%
kable_styling(latex_options = c("striped", "scale_down", "hold_position"), full_width = F)
tdata %>%
select_if(is.numeric) %>%
gather %>%
ggplot() +
facet_wrap(~ key, scales = "free") +
geom_density(aes(value, color = value, fill = key, alpha = .5)) + theme(axis.title = element_blank(), legend.position = "none") + ggtitle("Numeric Variable Density") + theme(plot.title = element_text(hjust = 0.5))
tdata %>%
select_if(is.numeric) %>%
gather %>%
ggplot(aes(value, key)) +
facet_wrap(~ key, scales = "free") +
geom_violin(aes(color = key, alpha = 1)) +
geom_boxplot(aes(fill = key, alpha = .5), notch = TRUE, size = .1, lty = 3) +
stat_summary(fun.y = mean, geom = "point",
shape = 8, size = 1.5, color = "#000000") +
theme(axis.text = element_blank(),
axis.title = element_blank(),
legend.position = "none") +
ggtitle("Numeric Variable KDE & Distribution") +
theme(plot.title = element_text(hjust = 0.5))
tdata %>%
select_if(is.integer) %>%
gather() %>%
filter(value == 0 | 1) %>%
group_by(key) %>%
ggplot() +
facet_wrap(~ key, scales = "free") +
geom_bar(aes(value, color = value, fill = key, alpha = .5)) + theme(axis.title = element_blank(), legend.position = "none") + ggtitle("Integer Frequencies") + theme(plot.title = element_text(hjust = 0.5))
tdata %>%
dplyr::select(TARGET_FLAG, MVR_PTS, CLM_FREQ, HOMEKIDS, KIDSDRIV, TIF) %>%
gather() %>%
ggplot(aes(value)) +
facet_wrap(~ key, scales = "free") +
geom_bar(aes(value, color = key, fill = key, alpha = .5)) + theme(axis.title = element_blank(), legend.position = "none") + ggtitle("Select Integer Frequencies") + theme(plot.title = element_text(hjust = 0.5))
tdata %>%
select_if(is.numeric) %>%
cor() %>%
ggcorrplot(method = "circle", type="upper",
ggtheme = ggplot2::theme_minimal, legend.title = "Influence") + coord_flip()
# Select character variables
chars <- tdata %>%
dplyr::select_if(is.character)
# Use function to extract dollars
to_num <- function(x){
x <- as.character(x)
x <- gsub(",", "", x)
x <- gsub("\\$", "", x)
as.numeric(x)
}
# Specify those dollar variables
income.values <- to_num(chars$INCOME)
home.values <- to_num(chars$HOME_VAL)
bluebook.values <- to_num(chars$BLUEBOOK)
oldclaim.values <- to_num(chars$OLDCLAIM)
concept_df <- as.data.frame(cbind(income.values,
home.values,
bluebook.values,
oldclaim.values))
income.values.stat <- to_num(chars$INCOME)
home.values.stat <- to_num(chars$HOME_VAL)
bluebook.values.stat <- to_num(chars$BLUEBOOK)
oldclaim.values.stat <- to_num(chars$OLDCLAIM)
# impute median values for missing variables
income.values[is.na(income.values)] <-
median(income.values, na.rm = TRUE)
home.values[is.na(home.values)] <-
median(home.values, na.rm = TRUE)
bluebook.values[is.na(bluebook.values)] <-
median(bluebook.values, na.rm = TRUE)
oldclaim.values[is.na(oldclaim.values)] <-
median(oldclaim.values, na.rm = TRUE)
# Recombine into data frame
dollar.values <-
data.frame(cbind(income.values,
home.values,
bluebook.values,
oldclaim.values))
dollar.values.stats <-
data.frame(cbind(income.values.stat,
home.values.stat,
bluebook.values.stat,
oldclaim.values.stat))
# Join with training data
tdata <- data.frame(cbind(tdata, dollar.values))
tdata %>%
dplyr::select(is.factor) %>%
dplyr::select("car_type", "education", "job") %>%
gather() %>%
ggplot(aes(value)) +
facet_wrap(~ key, nrow = 3, scales = "free") +
geom_bar(aes(, fill = key )) + theme(axis.title = element_blank(), axis.text.x = element_blank(), legend.position = "none") + coord_flip() + ggtitle("Nonbinary Classifiers") + theme(plot.title = element_text(hjust = 0.5))
